‚öôÔ∏è Flow ‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á ‚ÄúJump to Message‚Äù

‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° 1‚Äì5000 ‡πÅ‡∏•‡∏∞ user ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ jump ‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° #2150

1Ô∏è‚É£ ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ ‚Äúindex‚Äù ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏ô dataset
const index = messages.findIndex(m => m.id === targetId);

2Ô∏è‚É£ Virtuoso ‡∏°‡∏µ method ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏∏‡∏ì jump ‡πÑ‡∏î‡πâ
virtuosoRef.current.scrollToIndex({
  index,
  align: "center", // "start" | "center" | "end" | "auto"
  behavior: "smooth" // or "auto"
});


‚úÖ Virtuoso ‡∏à‡∏∞ render item ‡∏ô‡∏±‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏°‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏Å‡∏•‡∏°‡∏≤‡∏Å
‡πÅ‡∏•‡πâ‡∏ß scroll ‡πÑ‡∏õ‡∏´‡∏≤ position ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏≠‡∏Å

üß≠ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Chat ‡πÅ‡∏ö‡∏ö ‚ÄúASC ‡πÅ‡∏ï‡πà‡πÅ‡∏™‡∏î‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‚Äù

(‡πÄ‡∏ä‡πà‡∏ô‡πÅ‡∏≠‡∏û‡∏Ñ‡∏∏‡∏ì)

messages ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î ‚Üí ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î (ASC)

Virtuoso ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ö‡∏ö reverse scroll (‡∏•‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î)

Virtuoso ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢ prop ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ä‡∏∑‡πà‡∏≠ firstItemIndex + followOutput

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:

<Virtuoso
  data={messages}
  firstItemIndex={Math.max(0, totalMessages - messages.length)}
  initialTopMostItemIndex={totalMessages - 1} // ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà message ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  followOutput="smooth"
  ref={virtuosoRef}
/>


‡πÄ‡∏ß‡∏•‡∏≤ jump:

const jumpToMessage = (targetId) => {
  const index = messages.findIndex(m => m.id === targetId);
  if (index !== -1) {
    virtuosoRef.current.scrollToIndex({
      index,
      align: 'center',
      behavior: 'smooth'
    });
  }
};

üß† Special Case: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î (‡πÄ‡∏ä‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô batch ‡πÄ‡∏Å‡πà‡∏≤)

‡∏ñ‡πâ‡∏≤ user ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ jump ‡πÑ‡∏õ message #50 ‡πÅ‡∏ï‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà 350‚Äì370 ‡πÉ‡∏ô memory:

‡∏ï‡πâ‡∏≠‡∏á call backend ‚Üí fetch batch ‡∏ó‡∏µ‡πà‡∏°‡∏µ message #50

append ‡∏´‡∏£‡∏∑‡∏≠ prepend ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô list

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Virtuoso render ‡πÄ‡∏™‡∏£‡πá‡∏à ‚Üí call scrollToIndex() ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ

üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ ‚Äúlazy jump‚Äù ‚Äî ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å chat app ‡∏ó‡∏µ‡πà‡∏°‡∏µ pagination

üöÄ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á flow ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

user click ‚Äú‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‚Äù ‡∏Ç‡∏≠‡∏á message #50

frontend check ‚Üí ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ message #50?
‚Üí ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‚Üí call API GET /messages?around=50&limit=50

merge ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ dataset

Virtuoso scroll ‡πÑ‡∏õ index ‡∏Ç‡∏≠‡∏á message #50

highlight ‡∏™‡∏±‡∏Å 1‚Äì2 ‡∏ß‡∏¥ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ user ‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏±‡∏î‡∏ß‡πà‡∏≤ jump ‡∏°‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ


---------------------------------

‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö üî• ‚Äî ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏Ñ‡∏£‡∏ö flow ‡∏Ç‡∏≠‡∏á chat + Virtuoso + pagination ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏à‡∏∏‡∏î ‚Äújump‚Äù ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏ô‡∏µ‡πà‡πÅ‡∏´‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏°‡∏±‡∏ô tricky ‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á ‡πÜ

‡πÄ‡∏£‡∏≤‡∏°‡∏≤‡πÑ‡∏•‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏•‡∏¢ üëá

üåê ‡∏™‡∏£‡∏∏‡∏õ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á chat + Virtuoso ‡∏Å‡πà‡∏≠‡∏ô
‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥	‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•	‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á scroll
‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å	‡πÇ‡∏´‡∏•‡∏î ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 20 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô #351‚Äì370)	scroll ‡∏≠‡∏¢‡∏π‡πà ‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î
scroll ‡∏Ç‡∏∂‡πâ‡∏ô	‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏≤ (#331‚Äì350)	prepend message ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
scroll ‡∏•‡∏á	‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏∞‡πÑ‡∏£ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß	
üß≠ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏ï‡∏≠‡∏ô ‚ÄúJump to Message‚Äù

‡πÄ‡∏ä‡πà‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (#370)
user ‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á" ‡∏Ç‡∏≠‡∏á #50

‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡πÉ‡∏ô memory ‡πÅ‡∏Ñ‡πà #351‚Äì370
‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° #50 ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô list ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ

‚úÖ ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Chat apps ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏ä‡πâ)
1Ô∏è‚É£ ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤ message ‡∏ó‡∏µ‡πà‡∏à‡∏∞ jump ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô memory ‡πÑ‡∏´‡∏°
const targetIndex = messages.findIndex(m => m.id === targetId);
if (targetIndex !== -1) {
  // ‚úÖ ‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß ‚Üí scroll ‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
  virtuosoRef.current.scrollToIndex({ index: targetIndex, align: 'center' });
} else {
  // ‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Å‡πà‡∏≠‡∏ô
  loadAroundMessage(targetId);
}

2Ô∏è‚É£ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö ‡πÜ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á jump

‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÅ‡∏ö‡∏ö ‚Äúaround message‚Äù
‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Virtuoso ‡∏°‡∏µ context ‡∏ó‡∏±‡πâ‡∏á‡∏ö‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡πà‡∏≤‡∏á ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ message ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

‡πÄ‡∏ä‡πà‡∏ô API:

GET /messages?around=50&limit=40
‚Üí response: message #30‚Äì#70

3Ô∏è‚É£ Render + Scroll ‡πÑ‡∏õ‡∏´‡∏≤ message ‡∏ô‡∏±‡πâ‡∏ô

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:

setMessages(loadedMessages);
await nextTick(); // ‡∏´‡∏£‡∏∑‡∏≠ wait ‡∏à‡∏ô Virtuoso render ‡πÄ‡∏™‡∏£‡πá‡∏à
virtuosoRef.current.scrollToIndex({
  index: loadedMessages.findIndex(m => m.id === targetId),
  align: 'center'
});

4Ô∏è‚É£ ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô ‚Äú‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏° scroll‚Äù ‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å jump ‡πÅ‡∏•‡πâ‡∏ß user ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ scroll ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥:

‡∏ñ‡πâ‡∏≤ scroll ‚Äú‡∏Ç‡∏∂‡πâ‡∏ô‚Äù ‚Üí Virtuoso trigger callback startReached
‚Üí ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API GET /messages?before=<first_id>

‡∏ñ‡πâ‡∏≤ scroll ‚Äú‡∏•‡∏á‚Äù ‚Üí Virtuoso trigger callback endReached
‚Üí ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API GET /messages?after=<last_id>

üí° ‡∏™‡∏£‡∏∏‡∏õ: ‡∏´‡∏•‡∏±‡∏á jump ‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á list ‡πÅ‡∏•‡πâ‡∏ß, ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô scroll direction ‡πÉ‡∏î ‡πÜ ‡∏Å‡πá‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÇ‡∏´‡∏•‡∏î batch ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°

üß† Concept ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≥
‡∏™‡∏¥‡πà‡∏á	‡∏ß‡∏¥‡∏ò‡∏µ
Jump ‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß	scrollToIndex() ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
Jump ‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ	‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API around=<message_id> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô
Scroll ‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á jump	‡πÉ‡∏ä‡πâ startReached ‡πÇ‡∏´‡∏•‡∏î ‚Äú‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‚Äù
Scroll ‡∏•‡∏á‡∏´‡∏•‡∏±‡∏á jump	‡πÉ‡∏ä‡πâ endReached ‡πÇ‡∏´‡∏•‡∏î ‚Äú‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‚Äù
Virtuoso ‡∏à‡∏∞ maintain virtual window ‡πÄ‡∏≠‡∏á	‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î DOM ‡πÄ‡∏≠‡∏á



----------------------

‚öôÔ∏è ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á Telegram-style Chat Scroll

üß© Keyword ‡∏´‡∏•‡∏±‡∏Å:
‚ÄúAlways keep context window + smart fetch around target‚Äù

‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô frontend
interface ChatState {
  messages: Message[];      // ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
  totalCount: number;       // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á
  anchorMessageId?: string; // ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤ jump ‡∏°‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  firstMessageId?: string;  // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏Å‡πÉ‡∏ô memory
  lastMessageId?: string;   // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÉ‡∏ô memory
  hasMoreTop: boolean;
  hasMoreBottom: boolean;
}

üß≠ 1. ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‚Üí ‡πÇ‡∏´‡∏•‡∏î "‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î" ‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 350‚Äì370)
GET /messages?limit=20&order=desc
‚Üí response: [msg351 ... msg370]


‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô reverse ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Virtuoso
‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Virtuoso ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏≥‡∏î‡∏±‡∏ö ASC ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ index ‡∏ï‡∏£‡∏á

setMessages(response.reverse());
scrollToBottom(); // scroll index = last item

üß≠ 2. Scroll ‚Äú‡∏Ç‡∏∂‡πâ‡∏ô‚Äù ‚Üí ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°

Virtuoso ‡∏°‡∏µ callback:

<Virtuoso
  data={messages}
  firstItemIndex={state.firstItemIndex}
  startReached={loadOlderMessages}
/>

async function loadOlderMessages() {
  const firstId = messages[0].id;
  const older = await api.get(`/messages?before=${firstId}&limit=20`);
  setMessages([...older, ...messages]);
}

üß≠ 3. Scroll ‚Äú‡∏•‡∏á‚Äù ‚Üí ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°

‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏ä‡πà‡∏ô jump ‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ä‡∏ó

<Virtuoso
  endReached={loadNewerMessages}
/>

async function loadNewerMessages() {
  const lastId = messages[messages.length - 1].id;
  const newer = await api.get(`/messages?after=${lastId}&limit=20`);
  setMessages([...messages, ...newer]);
}

üß≠ 4. Jump to Message (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Telegram)

‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:

üîπ 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤ message ‡∏°‡∏µ‡πÉ‡∏ô list ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
const index = messages.findIndex(m => m.id === targetId);
if (index !== -1) {
  virtuosoRef.current.scrollToIndex({ index, align: 'center' });
  return;
}

üîπ 2. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‚Äúaround message‚Äù

‡πÄ‡∏ä‡πà‡∏ô Telegram API:

GET /messages?around=targetId&limit=40
‚Üí [msg980‚Äìmsg1020]

üîπ 3. Replace state ‡∏î‡πâ‡∏ß‡∏¢ block ‡πÉ‡∏´‡∏°‡πà
setMessages(newBlock);
await nextTick();
virtuosoRef.current.scrollToIndex({
  index: newBlock.findIndex(m => m.id === targetId),
  align: 'center'
});

üîπ 4. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° state ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏ö‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡πà‡∏≤‡∏á
state.firstMessageId = newBlock[0].id;
state.lastMessageId = newBlock[newBlock.length - 1].id;
state.hasMoreTop = newBlock[0].id !== "1";
state.hasMoreBottom = newBlock[newBlock.length - 1].id !== "370";


‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà ‚Äú‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ä‡∏ó‚Äù
Virtuoso ‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á ‡∏Ç‡∏∂‡πâ‡∏ô / ‡∏•‡∏á ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏±‡∏ö‡∏™‡∏ô

üì¶ Backend API ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
Endpoint	‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠	‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
GET /messages?limit=20&order=desc	‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å	‡πÇ‡∏´‡∏•‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î
GET /messages?before=<msg_id>&limit=20	scroll ‡∏Ç‡∏∂‡πâ‡∏ô	‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Å‡πà‡∏≤
GET /messages?after=<msg_id>&limit=20	scroll ‡∏•‡∏á	‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà (‡∏´‡∏•‡∏±‡∏á jump)
GET /messages?around=<msg_id>&limit=40	jump ‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á	‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≠‡∏ö ‡πÜ

‚úÖ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ñ‡∏ß‡∏£‡∏Ñ‡∏∑‡∏ô created_at ASC ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Virtuoso render ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
frontend ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ scroll position ‡πÄ‡∏≠‡∏á

üß† Trick ‡∏ó‡∏µ‡πà Telegram ‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á

‡∏û‡∏≠ jump ‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏à‡∏∞ preload ‡∏£‡∏≠‡∏ö ‡πÜ ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î
‡πÄ‡∏ä‡πà‡∏ô GET /messages?before=<msg980>&limit=100 background

‡πÉ‡∏ä‡πâ message anchor + offset
Telegram ‡∏°‡∏µ state ‚Äúoffset_id‚Äù ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö id ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥

‡∏ñ‡πâ‡∏≤ jump ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏µ unread marker
Telegram ‡∏à‡∏∞ scroll ‡πÉ‡∏´‡πâ ‚Äú‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° unread ‡πÅ‡∏£‡∏Å‚Äù ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏Ç‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á viewport

üí° Flow Summary
‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó
  ‚Üì
‡πÇ‡∏´‡∏•‡∏î messages (desc ‚Üí reverse ‚Üí asc)
  ‚Üì
Virtuoso render ‡∏à‡∏≤‡∏Å‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô
  ‚Üì
scroll up ‚Üí before=<first_id>
scroll down ‚Üí after=<last_id>
  ‚Üì
jump(targetId)
  ‚îú‚îÄ‚îÄ ‡∏°‡∏µ‡πÉ‡∏ô list ‚Üí scrollToIndex
  ‚îî‚îÄ‚îÄ ‡πÑ‡∏°‡πà‡∏°‡∏µ ‚Üí GET around=targetId
                ‚Üì
                replace messages
                ‚Üì
                scrollTo(targetId)